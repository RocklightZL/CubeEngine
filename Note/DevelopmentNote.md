记录整个项目的开发过程，包括想法、bug等。

从7.20开始记录（项目从7.3开始开发）。

# 7.20

开始开发CubeEditor

用**imgui**开发编辑器。

## 拖动imgui演示窗口出现拖影

原因是没有清除颜色缓冲区。

清除颜色缓冲区的代码放在了RenderSystem的更新逻辑里，而我不打算让编辑器的本身的UI渲染依赖于引擎内核的ECS架构，所以这部分代码应该放在Application循环的最开始。

# 7.21

完成了FrameBuffer封装，实现了基本的场景视图和场景面板。

## imgui复选框

checkbox第二个参数（也就是表示是否选中的bool变量指针）对应的bool变量初始化不能放在渲染循环里，否则点击复选框没反应，原因是状态每次都被重置了。

## ImGui对话框显示逻辑

OpenPopup() 将指定对话框标识为“需要显示”，即激活状态。

BeginPopup(): 当该对话框处于激活状态时返回true，显示内容，不处于激活状态时返回false，不显示。

CloseCurrentPopup(): 将当前对话框标识为“不显示”，即未激活状态。

当在一个对话框里调用OpenPopup() 意为打开一个子对话框，并且子对话框逻辑必须在父对话框内部，当父对话框退出时，子对话框也会退出。这就是不能把对话框逻辑写在右键菜单中的原因。

# 7.22

继续完善场景创建逻辑

目前的UI交互有点反人类，但是要改有点麻烦。我计划先完成场景创建逻辑以及序列化相关的东西，最后再一并完成交互优化和样式美化。

利用工厂类的方式实现组件类的反射。

## 静态成员函数

静态成员函数属于类本身，被子类继承时不会创建副本，通过子类类名调用的还是父类定义的那个函数，只有当子类重写（实际上是隐藏）这个函数时才会有一个副本（实际上就是两个不同的函数，实际上没有任何关系）。

## 延迟初始化

通过一个静态函数返回一个静态局部变量的引用，这就相当于一个延迟初始化的静态成员变量，只在函数第一次被调用时才初始化。

由于C++静态变量的初始化顺序是不确定的，当一个静态变量在初始化时用到了另一个静态变量，可能出现后者还没初始化的情况，这个时候就需要用到延迟初始化了。

## 静态变量的内存管理

如果静态变量中有动态申请的内存空间，虽然静态变量具有全局生命周期，在程序结束时没被手动释放的空间也会被回收，但这还是属于内存泄漏，某些情况下会出问题（比如dll被卸载了但是程序没结束）。所以需要在程序即将退出时调用清理函数，但这显然比较麻烦，这时候用智能指针就很合适。

# 7.23

继续完善编辑器

显示实体属性面板需要由组件ID或者组件指针得到组件类型名，还要确定转成哪种类型的组件指针，相当麻烦。直接硬编码了，至于是否该在编辑器中支持自定义组件，到时候再说。

目前感觉ECS架构好难用，可能考虑换架构。

场景的序列化和反序列化，这部分没有集成在scene类内部，而是单独封装了一个静态类，同时组件序列化器采用了哈希表存储函数指针的形式，保持组件类的纯粹性。
